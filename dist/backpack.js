!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Backpack=t():e.Backpack=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,n){e.exports=n(1).default},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(){function e(){r(this,e)}return a(e,[{key:"forceFallback",value:function(e){return e instanceof Error?(o.a.log(e),o.a.throwError(e)):(o.a.log(new Error(e).stack),o.a.cancelRequest(e))}},{key:"trigger",value:function(e,t){var n=new CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0});document.dispatchEvent(n)}},{key:"on",value:function(e,t){document.addEventListener(e,function(e){t(e)})}}]),e}();t.default=u},function(e,t,n){"use strict";const r={CORS_PROXY_SERVER:"http://cors.movableink.com",$:function(e,t){return t||(t=document),Array.prototype.slice.call(t.querySelectorAll(e))},param:function(e){return r.params()[e]},params:function(e){if(void 0===r._urlParams){r._urlParams={};for(var t,n=/([^&=]+)=?([^&]*)/g,o=r._searchString();t=n.exec(o);)r._urlParams[decodeURIComponent(t[1])]=decodeURIComponent(t[2])}return e?r._urlParams[e]:r._urlParams},_searchString:function(){return window.location.search.substring(1)},autofill:function(){r.param("init"),Object.keys(r._urlParams).forEach(function(e){"undefined"!==r._urlParams[e]&&r._urlParams[e].length>0&&document.getElementById("autofill_"+e)&&(document.getElementById("autofill_"+e).innerHTML=r._urlParams[e])})},throwError:function(e){"undefined"==typeof MICapture?r.log("Capturama error: "+e):MICapture.error(e)},cancelRequest:function(e){"undefined"==typeof MICapture?r.log("Request canceled: "+e):MICapture.cancel(e)},setImageRedirect:function(e){var t=document.querySelector("#mi-redirect-image");return t=t||document.createElement("a"),t.href=e,t.id="mi-redirect-image",t.style.display="none",document.body.appendChild(t),t},setClickthrough:function(e){var t=document.querySelector("#mi_dynamic_link");return t=t||document.createElement("a"),t.href=e,t.id="mi_dynamic_link",t.style.display="none",document.body.appendChild(t),t},setExtraData:function(e){var t=document.querySelector("#mi-data");t=t||document.createElement("div"),t.id="mi-data",t.style.display="none";var n;try{n=JSON.parse(t.getAttribute("data-mi-data"))||{}}catch(e){n={}}for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return t.setAttribute("data-mi-data",JSON.stringify(n)),document.body.appendChild(t),t},proxyUrl:function(e){var t=document.createElement("a"),n="";return t.href=e,n="0"===t.port||""===t.port?"https:"==t.protocol?":443":"":":"+t.port,[r.CORS_PROXY_SERVER,"/",t.hostname,n,t.pathname,t.search,t.hash].join("")},_readyToCapture:!0,_openCalls:0,_reset:function(){r._openCalls=0,r._readyToCapture=!0},suspend:function(e,t){t=t||"manual suspension",e&&(t+=", will end in "+e+"ms",setTimeout(function(){r.capture(t)},e)),r._openCalls++,r._readyToCapture=!1,"undefined"==typeof MICapture?r.log("suspended: "+t):MICapture.begin(t)},capture:function(e){if(--r._openCalls>0)return void r.log("outstanding calls, not capturing: "+e);r._readyToCapture=!0,"undefined"==typeof MICapture?r.log("now ready to capture: "+e):(r.$("body")[0].style.width=r.$("body")[0].offsetWidth+"px",MICapture.end(e))},getCORS:function(e,t,n){var o=Array.prototype.slice.call(arguments);return e=o[0],n=o.pop(),t=o[1]||{},t.corsCacheTime=t.corsCacheTime||1e4,e.match(/cors.movableink.com/)||(e=r.proxyUrl(e)),t.headers=t.headers||{},t.headers["x-reverse-proxy-ttl"]=t.corsCacheTime/1e3,t.headers["x-mi-cbe"]=this._hashForRequest(e,t),r.get(e,t,n)},get:function(e,t,n){var o=Array.prototype.slice.call(arguments);e=o[0],n=o.pop(),t=o[1]||{};var a="xhr: "+e,u=new XMLHttpRequest;if(u.onerror=function(){r.capture(a),r.log("XHR error for "+e),n(null,this.status)},u.onload=function(){r.capture(a);var e=this.getResponseHeader("content-type");n(this.responseText,this.status,e)},u.open(t.method||"GET",e,!0),u.withCredentials=!0,t.headers)for(var i in t.headers)u.setRequestHeader(i,t.headers[i]);u.send(t.body),r.suspend(t.maxSuspension,a)},getImage:function(e,t,n){var o=Array.prototype.slice.call(arguments);n=o.pop(),e=o[0],t=o[1]||{};var a="getImage: "+e,u=new Image;u.onload=function(){r.capture(a),n&&n(u)},u.onerror=function(){r.capture(a),n(null)},u.src=e,r.suspend(t.maxSuspension,a)},getImages:function(e,t,n,o){function a(){var e=s+1;c[e]&&(o&&o(c[e]),s=e,a())}function u(){0==i&&(r.capture(l),n&&n(c))}"function"==typeof t&&(o=n,n=t,t={}),t=t||{};for(var i=e.length,c=[],s=-1,l="getImages",d=0;d<e.length;d++)!function(e,t){var n=new Image;n.onload=function(){i-=1,c[t]=n,a(),u()},n.onerror=function(){i-=1,r.log("Image load error for "+e),u()},n.src=e}(e[d],d);r.suspend(t.maxSuspension,l)},waitForAsset:function(e){"undefined"==typeof MICapture?r.log("Wait for asset: "+e):MICapture.waitForAsset(e)},log:function(e){console.log(e)},_hashForRequest:function(e,t){var n=e+JSON.stringify(t),r=0;if(0===n.length)return r;for(var o=0;o<n.length;o++)r=(r<<5)-r+n.charCodeAt(o)&4294967295;return r.toString()}};t.a=r},function(e,t,n){e.exports=n(0)}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovLy9iYWNrcGFjay5qcyIsIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAgNzkzZTMxNjc1Y2MxNWU3NWY0ZjYiLCJ3ZWJwYWNrOi8vLy4vaW5kZXguanMiLCJ3ZWJwYWNrOi8vLy4vYmFja3BhY2suanMiLCJ3ZWJwYWNrOi8vLy4uL34vY3JvcGR1c3Rlci9zcmMvY3JvcGR1c3Rlci5qcyJdLCJuYW1lcyI6WyJyb290IiwiZmFjdG9yeSIsImV4cG9ydHMiLCJtb2R1bGUiLCJkZWZpbmUiLCJhbWQiLCJ0aGlzIiwibW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImluc3RhbGxlZE1vZHVsZXMiLCJpIiwibCIsImNhbGwiLCJtIiwiYyIsInZhbHVlIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJjb25maWd1cmFibGUiLCJlbnVtZXJhYmxlIiwiZ2V0IiwibiIsIl9fZXNNb2R1bGUiLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJkZWZhdWx0IiwiX2NsYXNzQ2FsbENoZWNrIiwiaW5zdGFuY2UiLCJDb25zdHJ1Y3RvciIsIlR5cGVFcnJvciIsIl9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9jcm9wZHVzdGVyX18iLCJfY3JlYXRlQ2xhc3MiLCJkZWZpbmVQcm9wZXJ0aWVzIiwidGFyZ2V0IiwicHJvcHMiLCJsZW5ndGgiLCJkZXNjcmlwdG9yIiwid3JpdGFibGUiLCJrZXkiLCJwcm90b1Byb3BzIiwic3RhdGljUHJvcHMiLCJCYWNrcGFjayIsImUiLCJFcnJvciIsImxvZyIsInRocm93RXJyb3IiLCJzdGFjayIsImNhbmNlbFJlcXVlc3QiLCJldmVudFR5cGUiLCJldmVudE1zZyIsImV2ZW50IiwiQ3VzdG9tRXZlbnQiLCJkZXRhaWwiLCJidWJibGVzIiwiY2FuY2VsYWJsZSIsImRvY3VtZW50IiwiZGlzcGF0Y2hFdmVudCIsImNhbGxiYWNrIiwiYWRkRXZlbnRMaXN0ZW5lciIsIkNEIiwiQ09SU19QUk9YWV9TRVJWRVIiLCIkIiwic2VsZWN0b3IiLCJkb2MiLCJBcnJheSIsInNsaWNlIiwicXVlcnlTZWxlY3RvckFsbCIsInBhcmFtIiwicGFyYW1zIiwiX3VybFBhcmFtcyIsIm1hdGNoIiwic2VhcmNoIiwicXVlcnkiLCJfc2VhcmNoU3RyaW5nIiwiZXhlYyIsImRlY29kZVVSSUNvbXBvbmVudCIsIndpbmRvdyIsImxvY2F0aW9uIiwic3Vic3RyaW5nIiwiYXV0b2ZpbGwiLCJrZXlzIiwiZm9yRWFjaCIsImdldEVsZW1lbnRCeUlkIiwiaW5uZXJIVE1MIiwibXNnIiwiTUlDYXB0dXJlIiwiZXJyb3IiLCJjYW5jZWwiLCJzZXRJbWFnZVJlZGlyZWN0IiwiaW1hZ2VVcmwiLCJhIiwicXVlcnlTZWxlY3RvciIsImNyZWF0ZUVsZW1lbnQiLCJocmVmIiwiaWQiLCJzdHlsZSIsImRpc3BsYXkiLCJib2R5IiwiYXBwZW5kQ2hpbGQiLCJzZXRDbGlja3Rocm91Z2giLCJ1cmwiLCJzZXRFeHRyYURhdGEiLCJkYXRhT2JqZWN0IiwiZWwiLCJleGlzdGluZ0RhdGEiLCJKU09OIiwicGFyc2UiLCJnZXRBdHRyaWJ1dGUiLCJzZXRBdHRyaWJ1dGUiLCJzdHJpbmdpZnkiLCJwcm94eVVybCIsInBvcnQiLCJwcm90b2NvbCIsImhvc3RuYW1lIiwicGF0aG5hbWUiLCJoYXNoIiwiam9pbiIsIl9yZWFkeVRvQ2FwdHVyZSIsIl9vcGVuQ2FsbHMiLCJfcmVzZXQiLCJzdXNwZW5kIiwibWF4U3VzcGVuc2lvbiIsInNldFRpbWVvdXQiLCJjYXB0dXJlIiwiYmVnaW4iLCJ3aWR0aCIsIm9mZnNldFdpZHRoIiwiZW5kIiwiZ2V0Q09SUyIsIm9wdGlvbnMiLCJhcmdzIiwiYXJndW1lbnRzIiwicG9wIiwiY29yc0NhY2hlVGltZSIsImhlYWRlcnMiLCJfaGFzaEZvclJlcXVlc3QiLCJyZXEiLCJYTUxIdHRwUmVxdWVzdCIsIm9uZXJyb3IiLCJzdGF0dXMiLCJvbmxvYWQiLCJjb250ZW50VHlwZSIsImdldFJlc3BvbnNlSGVhZGVyIiwicmVzcG9uc2VUZXh0Iiwib3BlbiIsIm1ldGhvZCIsIndpdGhDcmVkZW50aWFscyIsImhlYWRlciIsInNldFJlcXVlc3RIZWFkZXIiLCJzZW5kIiwiZ2V0SW1hZ2UiLCJpbWciLCJJbWFnZSIsInNyYyIsImdldEltYWdlcyIsInVybHMiLCJzaW5nbGVDYWxsYmFjayIsImNhbGxiYWNrTmV4dCIsIm5leHQiLCJjYWxsZWRJbmRleCIsImltZ3MiLCJmaW5pc2giLCJpbWFnZXNMZWZ0Iiwid2FpdEZvckFzc2V0IiwiYXNzZXRVcmwiLCJtZXNzYWdlIiwiY29uc29sZSIsInN0ciIsImNoYXJDb2RlQXQiLCJ0b1N0cmluZyJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBQUEsRUFBQUMsR0FDQSxnQkFBQUMsVUFBQSxnQkFBQUMsUUFDQUEsT0FBQUQsUUFBQUQsSUFDQSxrQkFBQUcsZ0JBQUFDLElBQ0FELFVBQUFILEdBQ0EsZ0JBQUFDLFNBQ0FBLFFBQUEsU0FBQUQsSUFFQUQsRUFBQSxTQUFBQyxLQUNDSyxLQUFBLFdBQ0QsTUNBZ0IsVUFBVUMsR0NOMUIsUUFBQUMsR0FBQUMsR0FHQSxHQUFBQyxFQUFBRCxHQUNBLE1BQUFDLEdBQUFELEdBQUFQLE9BR0EsSUFBQUMsR0FBQU8sRUFBQUQsSUFDQUUsRUFBQUYsRUFDQUcsR0FBQSxFQUNBVixXQVVBLE9BTkFLLEdBQUFFLEdBQUFJLEtBQUFWLEVBQUFELFFBQUFDLElBQUFELFFBQUFNLEdBR0FMLEVBQUFTLEdBQUEsRUFHQVQsRUFBQUQsUUF2QkEsR0FBQVEsS0ErREEsT0FuQ0FGLEdBQUFNLEVBQUFQLEVBR0FDLEVBQUFPLEVBQUFMLEVBR0FGLEVBQUFHLEVBQUEsU0FBQUssR0FBMkMsTUFBQUEsSUFHM0NSLEVBQUFTLEVBQUEsU0FBQWYsRUFBQWdCLEVBQUFDLEdBQ0FYLEVB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LDhCQUNBekcsRUFBQWYsSUFBQSxtQkFBQXdILEdBRUEvRSxVQUFBOEUsYUFBQUMsSUFJQXhILElBQUEsU0FBQXlILEdBQ0FDLFFBQUExSCxJQUFBeUgsSUFHQTlCLGdCQUFBLFNBQUFuQyxFQUFBNkIsR0FDQSxHQUFBc0MsR0FBQW5FLEVBQUFLLEtBQUFJLFVBQUFvQixHQUNBZCxFQUFBLENBQ0EsUUFBQW9ELEVBQUFwSSxPQUFBLE1BQUFnRixFQUNBLFFBQUFqSCxHQUFBLEVBQW1CQSxFQUFBcUssRUFBQXBJLE9BQWdCakMsSUFDbkNpSCxNQUFBLEdBQUFBLEVBQUFvRCxFQUFBQyxXQUFBdEssR0FBQSxVQUVBLE9BQUFpSCxHQUFBc0QsWUFJQWhMLEdBQUEsRUFBQWtFLEdKdUxNLFNBQVNqRSxFQUFRRCxFQUFTTSxHQUVoQ0wsRUFBT0QsUUFBVU0sRUFBb0IiLCJmaWxlIjoiYmFja3BhY2suanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShbXSwgZmFjdG9yeSk7XG5cdGVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKVxuXHRcdGV4cG9ydHNbXCJCYWNrcGFja1wiXSA9IGZhY3RvcnkoKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJCYWNrcGFja1wiXSA9IGZhY3RvcnkoKTtcbn0pKHRoaXMsIGZ1bmN0aW9uKCkge1xucmV0dXJuIFxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB3ZWJwYWNrL3VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24iLCIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShbXSwgZmFjdG9yeSk7XG5cdGVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKVxuXHRcdGV4cG9ydHNbXCJCYWNrcGFja1wiXSA9IGZhY3RvcnkoKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJCYWNrcGFja1wiXSA9IGZhY3RvcnkoKTtcbn0pKHRoaXMsIGZ1bmN0aW9uKCkge1xucmV0dXJuIC8qKioqKiovIChmdW5jdGlvbihtb2R1bGVzKSB7IC8vIHdlYnBhY2tCb290c3RyYXBcbi8qKioqKiovIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuLyoqKioqKi8gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbi8qKioqKiovIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbi8qKioqKiovIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSlcbi8qKioqKiovIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuLyoqKioqKi8gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbi8qKioqKiovIFx0XHRcdGk6IG1vZHVsZUlkLFxuLyoqKioqKi8gXHRcdFx0bDogZmFsc2UsXG4vKioqKioqLyBcdFx0XHRleHBvcnRzOiB7fVxuLyoqKioqKi8gXHRcdH07XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuLyoqKioqKi8gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4vKioqKioqLyBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuLyoqKioqKi8gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbi8qKioqKiovIFx0fVxuLyoqKioqKi9cbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gaWRlbnRpdHkgZnVuY3Rpb24gZm9yIGNhbGxpbmcgaGFybW9ueSBpbXBvcnRzIHdpdGggdGhlIGNvcnJlY3QgY29udGV4dFxuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmkgPSBmdW5jdGlvbih2YWx1ZSkgeyByZXR1cm4gdmFsdWU7IH07XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4vKioqKioqLyBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuLyoqKioqKi8gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHtcbi8qKioqKiovIFx0XHRcdFx0Y29uZmlndXJhYmxlOiBmYWxzZSxcbi8qKioqKiovIFx0XHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcbi8qKioqKiovIFx0XHRcdFx0Z2V0OiBnZXR0ZXJcbi8qKioqKiovIFx0XHRcdH0pO1xuLyoqKioqKi8gXHRcdH1cbi8qKioqKiovIFx0fTtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuLyoqKioqKi8gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuLyoqKioqKi8gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbi8qKioqKiovIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4vKioqKioqLyBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuLyoqKioqKi8gXHRcdHJldHVybiBnZXR0ZXI7XG4vKioqKioqLyBcdH07XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLyoqKioqKi8gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAzKTtcbi8qKioqKiovIH0pXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyoqKioqKi8gKFtcbi8qIDAgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG4vLyBhIGJpdCBvZiBhIGhhY2sgYnV0IGV4cG9ydGluZyBsaWtlIHRoaXMgZW5zdXJlcyB3ZSBkb24ndCBnZXRcbi8vIHRoZSBsaWIgZXhwb3J0ZWQgd2l0aCBgLmRlZmF1bHRgIGluIHRoZSBicm93c2VyXG5tb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oMSkuZGVmYXVsdDtcblxuLyoqKi8gfSxcbi8qIDEgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbi8qIGhhcm1vbnkgaW1wb3J0ICovIHZhciBfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfY3JvcGR1c3Rlcl9fID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKTtcbnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cblxuXG52YXIgQmFja3BhY2sgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEJhY2twYWNrKCkge1xuICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBCYWNrcGFjayk7XG4gIH1cblxuICBfY3JlYXRlQ2xhc3MoQmFja3BhY2ssIFt7XG4gICAga2V5OiAnZm9yY2VGYWxsYmFjaycsXG5cblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJzIHRoZSBmYWxsYmFjayBpbWFnZSB0byBzaG93LlxuICAgICAqXG4gICAgICogRGV0ZXJtaW5lIHRoZSB0eXBlIG9mIGVycm9yIHdlIGhhdmUgcGFzc2VkLlxuICAgICAqIFdhcyBpdCBzb21ldGhpbmcgd2Ugd2VyZSBsb29raW5nIGZvcjpcbiAgICAgKiBpLmUgbm90IGVub3VnaCBpdGVtcyAoaW4gd2hpY2ggY2FzZSBpdCBpcyBhIGNhbmNlbFJlcXVlc3QpXG4gICAgICpcbiAgICAgKiBPciB3YXMgaXQgYW4gZXJyb3Igd2UgZGlkbid0IGNhdGNoOlxuICAgICAqIGkuZSBBUEkgcmV0dXJuZWQgbm9uIEpTT04gaW5mb3JtYXRpb24gd2hlbiB3ZSB3ZXJlIGV4cGVjdGluZyBKU09OXG4gICAgICogKGluIHdoaWNoIGNhc2Ugd2UgdGhyb3cgYW4gZXJyb3IsIHdoaWNoIGluIHR1cm5zIG5vdGlmaWVzIERldilcbiAgICAgKlxuICAgICAqIEBwYXJhbSBlXG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICovXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGZvcmNlRmFsbGJhY2soZSkge1xuICAgICAgaWYgKGUgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICBfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfY3JvcGR1c3Rlcl9fW1wiYVwiIC8qIGRlZmF1bHQgKi9dLmxvZyhlKTtcbiAgICAgICAgcmV0dXJuIF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9jcm9wZHVzdGVyX19bXCJhXCIgLyogZGVmYXVsdCAqL10udGhyb3dFcnJvcihlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9jcm9wZHVzdGVyX19bXCJhXCIgLyogZGVmYXVsdCAqL10ubG9nKG5ldyBFcnJvcihlKS5zdGFjayk7XG4gICAgICAgIHJldHVybiBfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfY3JvcGR1c3Rlcl9fW1wiYVwiIC8qIGRlZmF1bHQgKi9dLmNhbmNlbFJlcXVlc3QoZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqKipcbiAgICAgKiBDcmVhdGVzIGEgc3ludGhldGljIGV2ZW50XG4gICAgICogQHBhcmFtIGV2ZW50VHlwZVxuICAgICAqIEBwYXJhbSBldmVudE1zZ1xuICAgICAqIEByZXR1cm5zIHtFdmVudH1cbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiAndHJpZ2dlcicsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHRyaWdnZXIoZXZlbnRUeXBlLCBldmVudE1zZykge1xuXG4gICAgICB2YXIgZXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoZXZlbnRUeXBlLCB7XG4gICAgICAgIGRldGFpbDogZXZlbnRNc2csXG4gICAgICAgIGJ1YmJsZXM6IHRydWUsXG4gICAgICAgIGNhbmNlbGFibGU6IHRydWVcbiAgICAgIH0pO1xuXG4gICAgICBkb2N1bWVudC5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcbiAgICB9XG5cbiAgICAvKioqXG4gICAgICogQXR0YWNoZXMgYW4gZXZlbnRcbiAgICAgKiBAcGFyYW0gZXZlbnRcbiAgICAgKiBAcGFyYW0gY2FsbGJhY2tcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiAnb24nLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBvbihldmVudCwgY2FsbGJhY2spIHtcblxuICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgY2FsbGJhY2soZSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gQmFja3BhY2s7XG59KCk7XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gZXhwb3J0c1tcImRlZmF1bHRcIl0gPSBCYWNrcGFjaztcblxuLyoqKi8gfSxcbi8qIDIgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cInVzZSBzdHJpY3RcIjtcbmNvbnN0IENEID0ge1xuICBDT1JTX1BST1hZX1NFUlZFUiA6IFwiaHR0cDovL2NvcnMubW92YWJsZWluay5jb21cIixcblxuICAkOiBmdW5jdGlvbihzZWxlY3RvciwgZG9jKSB7XG4gICAgaWYoIWRvYykgeyBkb2MgPSBkb2N1bWVudDsgfVxuICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChkb2MucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcikpO1xuICB9LFxuXG4gIHBhcmFtOiBmdW5jdGlvbihuYW1lKSB7XG4gICAgcmV0dXJuIENELnBhcmFtcygpW25hbWVdO1xuICB9LFxuXG4gIHBhcmFtczogZnVuY3Rpb24obmFtZSkge1xuICAgIGlmKHR5cGVvZihDRC5fdXJsUGFyYW1zKSA9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICBDRC5fdXJsUGFyYW1zID0ge307XG4gICAgICB2YXIgbWF0Y2g7XG4gICAgICB2YXIgc2VhcmNoID0gLyhbXiY9XSspPT8oW14mXSopL2c7XG4gICAgICB2YXIgcXVlcnkgID0gQ0QuX3NlYXJjaFN0cmluZygpO1xuICAgICAgd2hpbGUgKG1hdGNoID0gc2VhcmNoLmV4ZWMocXVlcnkpKVxuICAgICAgICBDRC5fdXJsUGFyYW1zW2RlY29kZVVSSUNvbXBvbmVudChtYXRjaFsxXSldID0gZGVjb2RlVVJJQ29tcG9uZW50KG1hdGNoWzJdKTtcbiAgICB9XG4gICAgaWYgKG5hbWUpIHtcbiAgICAgIHJldHVybiBDRC5fdXJsUGFyYW1zW25hbWVdO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gQ0QuX3VybFBhcmFtcztcbiAgICB9XG4gIH0sXG5cbiAgX3NlYXJjaFN0cmluZzogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHdpbmRvdy5sb2NhdGlvbi5zZWFyY2guc3Vic3RyaW5nKDEpO1xuICB9LFxuXG4gIGF1dG9maWxsOiBmdW5jdGlvbigpIHtcbiAgICBDRC5wYXJhbShcImluaXRcIik7IC8vIGluaXRzIENELl91cmxQYXJhbXNcbiAgICBPYmplY3Qua2V5cyhDRC5fdXJsUGFyYW1zKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgIGlmIChDRC5fdXJsUGFyYW1zW2tleV0gIT09IFwidW5kZWZpbmVkXCIgJiYgQ0QuX3VybFBhcmFtc1trZXldLmxlbmd0aCA+IDApIHtcbiAgICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYXV0b2ZpbGxfXCIgKyBrZXkpKSB7XG4gICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhdXRvZmlsbF9cIiArIGtleSkuaW5uZXJIVE1MID0gQ0QuX3VybFBhcmFtc1trZXldO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG5cbiAgdGhyb3dFcnJvcjogZnVuY3Rpb24obXNnKSB7XG4gICAgaWYodHlwZW9mKE1JQ2FwdHVyZSkgPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgQ0QubG9nKFwiQ2FwdHVyYW1hIGVycm9yOiBcIiArIG1zZyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIE1JQ2FwdHVyZS5lcnJvcihtc2cpO1xuICAgIH1cbiAgfSxcblxuICBjYW5jZWxSZXF1ZXN0OiBmdW5jdGlvbihtc2cpIHtcbiAgICBpZih0eXBlb2YoTUlDYXB0dXJlKSA9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICBDRC5sb2coXCJSZXF1ZXN0IGNhbmNlbGVkOiBcIiArIG1zZyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIE1JQ2FwdHVyZS5jYW5jZWwobXNnKTtcbiAgICB9XG4gIH0sXG5cbiAgc2V0SW1hZ2VSZWRpcmVjdDogZnVuY3Rpb24oaW1hZ2VVcmwpIHtcbiAgICB2YXIgYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbWktcmVkaXJlY3QtaW1hZ2VcIik7XG4gICAgYSA9IGEgfHwgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuXG4gICAgYS5ocmVmID0gaW1hZ2VVcmw7XG4gICAgYS5pZCA9IFwibWktcmVkaXJlY3QtaW1hZ2VcIjtcbiAgICBhLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcblxuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYSk7XG5cbiAgICByZXR1cm4gYTtcbiAgfSxcblxuICBzZXRDbGlja3Rocm91Z2g6IGZ1bmN0aW9uKHVybCkge1xuICAgIHZhciBhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtaV9keW5hbWljX2xpbmtcIik7XG4gICAgYSA9IGEgfHwgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuICAgIGEuaHJlZiA9IHVybDtcbiAgICBhLmlkID0gXCJtaV9keW5hbWljX2xpbmtcIjtcbiAgICBhLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGEpO1xuXG4gICAgcmV0dXJuIGE7XG4gIH0sXG5cbiAgc2V0RXh0cmFEYXRhOiBmdW5jdGlvbihkYXRhT2JqZWN0KSB7XG4gICAgdmFyIGVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtaS1kYXRhXCIpO1xuICAgIGVsID0gZWwgfHwgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgZWwuaWQgPSBcIm1pLWRhdGFcIjtcbiAgICBlbC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cbiAgICB2YXIgZXhpc3RpbmdEYXRhO1xuICAgIHRyeSB7XG4gICAgICBleGlzdGluZ0RhdGEgPSBKU09OLnBhcnNlKGVsLmdldEF0dHJpYnV0ZSgnZGF0YS1taS1kYXRhJykpIHx8IHt9O1xuICAgIH0gY2F0Y2goZSkge1xuICAgICAgLy8gT3ZlcndyaXRlIGlmIHRoZXJlIHdhcyBzb21ldGhpbmcgaW4gbWktZGF0YSB0aGF0IHdhc24ndCBKU09OXG4gICAgICBleGlzdGluZ0RhdGEgPSB7fTtcbiAgICB9XG5cbiAgICBmb3IodmFyIGkgaW4gZGF0YU9iamVjdCkge1xuICAgICAgaWYoZGF0YU9iamVjdC5oYXNPd25Qcm9wZXJ0eShpKSkge1xuICAgICAgICBleGlzdGluZ0RhdGFbaV0gPSBkYXRhT2JqZWN0W2ldO1xuICAgICAgfVxuICAgIH1cbiAgICBlbC5zZXRBdHRyaWJ1dGUoJ2RhdGEtbWktZGF0YScsIEpTT04uc3RyaW5naWZ5KGV4aXN0aW5nRGF0YSkpO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZWwpO1xuXG4gICAgcmV0dXJuIGVsO1xuICB9LFxuXG4gIHByb3h5VXJsOiBmdW5jdGlvbih1cmwpIHtcbiAgICB2YXIgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgICB2YXIgcG9ydCA9IFwiXCI7XG4gICAgYS5ocmVmID0gdXJsO1xuXG4gICAgaWYgKGEucG9ydCA9PT0gJzAnIHx8IGEucG9ydCA9PT0gXCJcIikge1xuICAgICAgcG9ydCA9IGEucHJvdG9jb2wgPT0gXCJodHRwczpcIiA/IFwiOjQ0M1wiIDogXCJcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgcG9ydCA9IFwiOlwiICsgYS5wb3J0O1xuICAgIH1cblxuICAgIHJldHVybiBbXG4gICAgICBDRC5DT1JTX1BST1hZX1NFUlZFUixcbiAgICAgIFwiL1wiLFxuICAgICAgYS5ob3N0bmFtZSxcbiAgICAgIHBvcnQsXG4gICAgICBhLnBhdGhuYW1lLFxuICAgICAgYS5zZWFyY2gsXG4gICAgICBhLmhhc2hcbiAgICBdLmpvaW4oXCJcIik7XG4gIH0sXG5cbiAgLy8gaW50ZXJuYWwsIGRvIG5vdCBtb2RpZnlcbiAgX3JlYWR5VG9DYXB0dXJlOiB0cnVlLFxuXG4gIF9vcGVuQ2FsbHM6IDAsXG5cbiAgX3Jlc2V0OiBmdW5jdGlvbigpIHtcbiAgICBDRC5fb3BlbkNhbGxzID0gMDtcbiAgICBDRC5fcmVhZHlUb0NhcHR1cmUgPSB0cnVlO1xuICB9LFxuXG4gIHN1c3BlbmQ6IGZ1bmN0aW9uKG1heFN1c3BlbnNpb24sIG1zZykge1xuICAgIG1zZyA9IG1zZyB8fCBcIm1hbnVhbCBzdXNwZW5zaW9uXCI7XG5cbiAgICBpZihtYXhTdXNwZW5zaW9uKSB7XG4gICAgICBtc2cgKz0gXCIsIHdpbGwgZW5kIGluIFwiICsgbWF4U3VzcGVuc2lvbiArIFwibXNcIjtcblxuICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgQ0QuY2FwdHVyZShtc2cpO1xuICAgICAgfSwgbWF4U3VzcGVuc2lvbik7XG4gICAgfVxuXG4gICAgQ0QuX29wZW5DYWxscysrO1xuICAgIENELl9yZWFkeVRvQ2FwdHVyZSA9IGZhbHNlO1xuICAgIGlmICh0eXBlb2YoTUlDYXB0dXJlKSA9PSAndW5kZWZpbmVkJykge1xuICAgICAgQ0QubG9nKFwic3VzcGVuZGVkOiBcIiArIG1zZyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIE1JQ2FwdHVyZS5iZWdpbihtc2cpO1xuICAgIH1cbiAgfSxcblxuICBjYXB0dXJlOiBmdW5jdGlvbihtc2cpIHtcbiAgICBDRC5fb3BlbkNhbGxzLS07XG5cbiAgICBpZihDRC5fb3BlbkNhbGxzID4gMCkge1xuICAgICAgQ0QubG9nKFwib3V0c3RhbmRpbmcgY2FsbHMsIG5vdCBjYXB0dXJpbmc6IFwiICsgbXNnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBDRC5fcmVhZHlUb0NhcHR1cmUgPSB0cnVlO1xuICAgIGlmKHR5cGVvZihNSUNhcHR1cmUpID09ICd1bmRlZmluZWQnKSB7XG4gICAgICBDRC5sb2coXCJub3cgcmVhZHkgdG8gY2FwdHVyZTogXCIgKyBtc2cpO1xuICAgIH0gZWxzZSB7XG4gICAgICBDRC4kKCdib2R5JylbMF0uc3R5bGUud2lkdGggPSBDRC4kKCdib2R5JylbMF0ub2Zmc2V0V2lkdGggKyAncHgnO1xuICAgICAgTUlDYXB0dXJlLmVuZChtc2cpO1xuICAgIH1cbiAgfSxcblxuICBnZXRDT1JTOiBmdW5jdGlvbih1cmwsIG9wdGlvbnMsIGNhbGxiYWNrKSB7XG4gICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO1xuXG4gICAgdXJsID0gYXJnc1swXTtcbiAgICBjYWxsYmFjayA9IGFyZ3MucG9wKCk7XG4gICAgb3B0aW9ucyA9IGFyZ3NbMV0gfHwge307XG5cbiAgICBvcHRpb25zLmNvcnNDYWNoZVRpbWUgPSBvcHRpb25zLmNvcnNDYWNoZVRpbWUgfHwgMTAgKiAxMDAwO1xuICAgIGlmKCF1cmwubWF0Y2goL2NvcnMubW92YWJsZWluay5jb20vKSkge1xuICAgICAgdXJsID0gQ0QucHJveHlVcmwodXJsKTtcbiAgICB9XG5cbiAgICBvcHRpb25zLmhlYWRlcnMgPSBvcHRpb25zLmhlYWRlcnMgfHwge307XG4gICAgb3B0aW9ucy5oZWFkZXJzWyd4LXJldmVyc2UtcHJveHktdHRsJ10gPSBvcHRpb25zLmNvcnNDYWNoZVRpbWUgLyAxMDAwO1xuICAgIG9wdGlvbnMuaGVhZGVyc1sneC1taS1jYmUnXSA9IHRoaXMuX2hhc2hGb3JSZXF1ZXN0KHVybCwgb3B0aW9ucyk7XG5cbiAgICByZXR1cm4gQ0QuZ2V0KHVybCwgb3B0aW9ucywgY2FsbGJhY2spO1xuICB9LFxuXG4gIGdldDogZnVuY3Rpb24odXJsLCBvcHRpb25zLCBjYWxsYmFjaykge1xuICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtcblxuICAgIHVybCA9IGFyZ3NbMF07XG4gICAgY2FsbGJhY2sgPSBhcmdzLnBvcCgpO1xuICAgIG9wdGlvbnMgPSBhcmdzWzFdIHx8IHt9O1xuXG4gICAgdmFyIG1zZyA9IFwieGhyOiBcIiArIHVybDtcblxuICAgIHZhciByZXEgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblxuICAgIHJlcS5vbmVycm9yID0gZnVuY3Rpb24gKCkge1xuICAgICAgQ0QuY2FwdHVyZShtc2cpO1xuICAgICAgQ0QubG9nKFwiWEhSIGVycm9yIGZvciBcIiArIHVybCk7XG4gICAgICBjYWxsYmFjayhudWxsLCB0aGlzLnN0YXR1cyk7XG4gICAgfTtcbiAgICByZXEub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICBDRC5jYXB0dXJlKG1zZyk7XG4gICAgICB2YXIgY29udGVudFR5cGUgPSB0aGlzLmdldFJlc3BvbnNlSGVhZGVyKCdjb250ZW50LXR5cGUnKTtcbiAgICAgIGNhbGxiYWNrKHRoaXMucmVzcG9uc2VUZXh0LCB0aGlzLnN0YXR1cywgY29udGVudFR5cGUpO1xuICAgIH07XG5cbiAgICByZXEub3BlbihvcHRpb25zLm1ldGhvZCB8fCAnR0VUJywgdXJsLCB0cnVlKTtcblxuICAgIHJlcS53aXRoQ3JlZGVudGlhbHMgPSB0cnVlO1xuXG4gICAgaWYob3B0aW9ucy5oZWFkZXJzKSB7XG4gICAgICBmb3IodmFyIGhlYWRlciBpbiBvcHRpb25zLmhlYWRlcnMpIHtcbiAgICAgICAgcmVxLnNldFJlcXVlc3RIZWFkZXIoaGVhZGVyLCBvcHRpb25zLmhlYWRlcnNbaGVhZGVyXSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmVxLnNlbmQob3B0aW9ucy5ib2R5KTtcbiAgICBDRC5zdXNwZW5kKG9wdGlvbnMubWF4U3VzcGVuc2lvbiwgbXNnKTtcbiAgfSxcblxuICBnZXRJbWFnZTogZnVuY3Rpb24odXJsLCBvcHRpb25zLCBjYWxsYmFjaykge1xuICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtcblxuICAgIGNhbGxiYWNrID0gYXJncy5wb3AoKTtcbiAgICB1cmwgPSBhcmdzWzBdO1xuICAgIG9wdGlvbnMgPSBhcmdzWzFdIHx8IHt9O1xuICAgIHZhciBtc2cgPSBcImdldEltYWdlOiBcIiArIHVybDtcblxuICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTtcbiAgICBpbWcub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICBDRC5jYXB0dXJlKG1zZyk7XG4gICAgICBpZihjYWxsYmFjaykgeyBjYWxsYmFjayhpbWcpOyB9XG4gICAgfTtcbiAgICBpbWcub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgQ0QuY2FwdHVyZShtc2cpO1xuICAgICAgY2FsbGJhY2sobnVsbCk7XG4gICAgfTtcbiAgICBpbWcuc3JjID0gdXJsO1xuICAgIENELnN1c3BlbmQob3B0aW9ucy5tYXhTdXNwZW5zaW9uLCBtc2cpO1xuICB9LFxuXG4gIGdldEltYWdlczogZnVuY3Rpb24odXJscywgb3B0aW9ucywgY2FsbGJhY2ssIHNpbmdsZUNhbGxiYWNrKSB7XG4gICAgaWYodHlwZW9mKG9wdGlvbnMpID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgIHNpbmdsZUNhbGxiYWNrID0gY2FsbGJhY2s7XG4gICAgICBjYWxsYmFjayA9IG9wdGlvbnM7XG4gICAgICBvcHRpb25zID0ge307XG4gICAgfVxuXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG5cbiAgICB2YXIgaW1hZ2VzTGVmdCA9IHVybHMubGVuZ3RoO1xuICAgIHZhciBpbWdzID0gW107XG4gICAgdmFyIGNhbGxlZEluZGV4ID0gLTE7XG4gICAgdmFyIG1zZyA9IFwiZ2V0SW1hZ2VzXCI7XG5cbiAgICBmb3IodmFyIGkgPSAwOyBpIDwgdXJscy5sZW5ndGg7IGkrKykge1xuICAgICAgKGZ1bmN0aW9uKHVybCwgaSl7XG5cbiAgICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpO1xuXG4gICAgICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpbWFnZXNMZWZ0IC09IDE7XG4gICAgICAgICAgaW1nc1tpXSA9IGltZztcbiAgICAgICAgICBjYWxsYmFja05leHQoKTtcbiAgICAgICAgICBmaW5pc2goKTtcbiAgICAgICAgfTtcbiAgICAgICAgaW1nLm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpbWFnZXNMZWZ0IC09IDE7XG4gICAgICAgICAgQ0QubG9nKFwiSW1hZ2UgbG9hZCBlcnJvciBmb3IgXCIgKyB1cmwpO1xuICAgICAgICAgIGZpbmlzaCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGltZy5zcmMgPSB1cmw7XG4gICAgICB9KSh1cmxzW2ldLCBpKTtcbiAgICB9XG5cbiAgICBDRC5zdXNwZW5kKG9wdGlvbnMubWF4U3VzcGVuc2lvbiwgbXNnKTtcblxuICAgIGZ1bmN0aW9uIGNhbGxiYWNrTmV4dCgpIHtcbiAgICAgIHZhciBuZXh0ID0gY2FsbGVkSW5kZXggKyAxO1xuICAgICAgaWYoaW1nc1tuZXh0XSkge1xuICAgICAgICBpZihzaW5nbGVDYWxsYmFjaykge1xuICAgICAgICAgIHNpbmdsZUNhbGxiYWNrKGltZ3NbbmV4dF0pO1xuICAgICAgICB9XG4gICAgICAgIGNhbGxlZEluZGV4ID0gbmV4dDtcbiAgICAgICAgY2FsbGJhY2tOZXh0KCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZmluaXNoKCkge1xuICAgICAgaWYoaW1hZ2VzTGVmdCA9PSAwKSB7XG4gICAgICAgIENELmNhcHR1cmUobXNnKTtcbiAgICAgICAgaWYoY2FsbGJhY2spIHtcbiAgICAgICAgICBjYWxsYmFjayhpbWdzKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcblxuICB3YWl0Rm9yQXNzZXQ6IGZ1bmN0aW9uKGFzc2V0VXJsKSB7XG4gICAgaWYodHlwZW9mKE1JQ2FwdHVyZSkgPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgQ0QubG9nKFwiV2FpdCBmb3IgYXNzZXQ6IFwiICsgYXNzZXRVcmwpO1xuICAgIH0gZWxzZSB7XG4gICAgICBNSUNhcHR1cmUud2FpdEZvckFzc2V0KGFzc2V0VXJsKTtcbiAgICB9XG4gIH0sXG5cbiAgbG9nOiBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAgY29uc29sZS5sb2cobWVzc2FnZSk7XG4gIH0sXG5cbiAgX2hhc2hGb3JSZXF1ZXN0OiBmdW5jdGlvbih1cmwsIG9wdGlvbnMpIHtcbiAgICB2YXIgc3RyID0gdXJsICsgSlNPTi5zdHJpbmdpZnkob3B0aW9ucyk7XG4gICAgdmFyIGhhc2ggPSAwO1xuICAgIGlmIChzdHIubGVuZ3RoID09PSAwKSByZXR1cm4gaGFzaDtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykge1xuICAgICAgaGFzaCA9ICgoaGFzaCA8PCA1KSAtIGhhc2gpICsgc3RyLmNoYXJDb2RlQXQoaSkgJiAweEZGRkZGRkZGO1xuICAgIH1cbiAgICByZXR1cm4gaGFzaC50b1N0cmluZygpO1xuICB9XG59O1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIGV4cG9ydHNbXCJhXCJdID0gQ0Q7XG5cblxuLyoqKi8gfSxcbi8qIDMgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5tb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oMCk7XG5cblxuLyoqKi8gfVxuLyoqKioqKi8gXSk7XG59KTtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYmFja3BhY2suanMiLCIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSlcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcblxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gaWRlbnRpdHkgZnVuY3Rpb24gZm9yIGNhbGxpbmcgaGFybW9ueSBpbXBvcnRzIHdpdGggdGhlIGNvcnJlY3QgY29udGV4dFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5pID0gZnVuY3Rpb24odmFsdWUpIHsgcmV0dXJuIHZhbHVlOyB9O1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHtcbiBcdFx0XHRcdGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gXHRcdFx0XHRlbnVtZXJhYmxlOiB0cnVlLFxuIFx0XHRcdFx0Z2V0OiBnZXR0ZXJcbiBcdFx0XHR9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAzKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB3ZWJwYWNrL2Jvb3RzdHJhcCA3OTNlMzE2NzVjYzE1ZTc1ZjRmNiIsIi8vIGEgYml0IG9mIGEgaGFjayBidXQgZXhwb3J0aW5nIGxpa2UgdGhpcyBlbnN1cmVzIHdlIGRvbid0IGdldFxuLy8gdGhlIGxpYiBleHBvcnRlZCB3aXRoIGAuZGVmYXVsdGAgaW4gdGhlIGJyb3dzZXJcbm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi9iYWNrcGFjaycpLmRlZmF1bHQ7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9pbmRleC5qcyIsImltcG9ydCBDRCBmcm9tICdjcm9wZHVzdGVyJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQmFja3BhY2sge1xuXG4gIC8qKlxuICAgKiBUcmlnZ2VycyB0aGUgZmFsbGJhY2sgaW1hZ2UgdG8gc2hvdy5cbiAgICpcbiAgICogRGV0ZXJtaW5lIHRoZSB0eXBlIG9mIGVycm9yIHdlIGhhdmUgcGFzc2VkLlxuICAgKiBXYXMgaXQgc29tZXRoaW5nIHdlIHdlcmUgbG9va2luZyBmb3I6XG4gICAqIGkuZSBub3QgZW5vdWdoIGl0ZW1zIChpbiB3aGljaCBjYXNlIGl0IGlzIGEgY2FuY2VsUmVxdWVzdClcbiAgICpcbiAgICogT3Igd2FzIGl0IGFuIGVycm9yIHdlIGRpZG4ndCBjYXRjaDpcbiAgICogaS5lIEFQSSByZXR1cm5lZCBub24gSlNPTiBpbmZvcm1hdGlvbiB3aGVuIHdlIHdlcmUgZXhwZWN0aW5nIEpTT05cbiAgICogKGluIHdoaWNoIGNhc2Ugd2UgdGhyb3cgYW4gZXJyb3IsIHdoaWNoIGluIHR1cm5zIG5vdGlmaWVzIERldilcbiAgICpcbiAgICogQHBhcmFtIGVcbiAgICogQHJldHVybnMgeyp9XG4gICAqL1xuICBmb3JjZUZhbGxiYWNrKGUpe1xuICAgIGlmKGUgaW5zdGFuY2VvZiBFcnJvcil7XG4gICAgICBDRC5sb2coZSk7XG4gICAgICByZXR1cm4gQ0QudGhyb3dFcnJvcihlKTtcbiAgICB9IGVsc2V7XG4gICAgICBDRC5sb2cobmV3IEVycm9yKGUpLnN0YWNrKTtcbiAgICAgIHJldHVybiBDRC5jYW5jZWxSZXF1ZXN0KGUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKioqXG4gICAqIENyZWF0ZXMgYSBzeW50aGV0aWMgZXZlbnRcbiAgICogQHBhcmFtIGV2ZW50VHlwZVxuICAgKiBAcGFyYW0gZXZlbnRNc2dcbiAgICogQHJldHVybnMge0V2ZW50fVxuICAgKi9cbiAgdHJpZ2dlcihldmVudFR5cGUsIGV2ZW50TXNnKXtcblxuICAgIGNvbnN0IGV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KGV2ZW50VHlwZSwge1xuICAgICAgZGV0YWlsICAgICA6IGV2ZW50TXNnLFxuICAgICAgYnViYmxlcyAgICA6IHRydWUsXG4gICAgICBjYW5jZWxhYmxlIDogdHJ1ZVxuICAgIH0pO1xuXG4gICAgZG9jdW1lbnQuZGlzcGF0Y2hFdmVudChldmVudCk7XG5cbiAgfVxuXG5cbiAgLyoqKlxuICAgKiBBdHRhY2hlcyBhbiBldmVudFxuICAgKiBAcGFyYW0gZXZlbnRcbiAgICogQHBhcmFtIGNhbGxiYWNrXG4gICAqL1xuICBvbihldmVudCwgY2FsbGJhY2spe1xuXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgKGUpID0+e1xuICAgICAgY2FsbGJhY2soZSk7XG4gICAgfSk7XG5cbiAgfVxuXG59XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9iYWNrcGFjay5qcyIsImNvbnN0IENEID0ge1xuICBDT1JTX1BST1hZX1NFUlZFUiA6IFwiaHR0cDovL2NvcnMubW92YWJsZWluay5jb21cIixcblxuICAkOiBmdW5jdGlvbihzZWxlY3RvciwgZG9jKSB7XG4gICAgaWYoIWRvYykgeyBkb2MgPSBkb2N1bWVudDsgfVxuICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChkb2MucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcikpO1xuICB9LFxuXG4gIHBhcmFtOiBmdW5jdGlvbihuYW1lKSB7XG4gICAgcmV0dXJuIENELnBhcmFtcygpW25hbWVdO1xuICB9LFxuXG4gIHBhcmFtczogZnVuY3Rpb24obmFtZSkge1xuICAgIGlmKHR5cGVvZihDRC5fdXJsUGFyYW1zKSA9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICBDRC5fdXJsUGFyYW1zID0ge307XG4gICAgICB2YXIgbWF0Y2g7XG4gICAgICB2YXIgc2VhcmNoID0gLyhbXiY9XSspPT8oW14mXSopL2c7XG4gICAgICB2YXIgcXVlcnkgID0gQ0QuX3NlYXJjaFN0cmluZygpO1xuICAgICAgd2hpbGUgKG1hdGNoID0gc2VhcmNoLmV4ZWMocXVlcnkpKVxuICAgICAgICBDRC5fdXJsUGFyYW1zW2RlY29kZVVSSUNvbXBvbmVudChtYXRjaFsxXSldID0gZGVjb2RlVVJJQ29tcG9uZW50KG1hdGNoWzJdKTtcbiAgICB9XG4gICAgaWYgKG5hbWUpIHtcbiAgICAgIHJldHVybiBDRC5fdXJsUGFyYW1zW25hbWVdO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gQ0QuX3VybFBhcmFtcztcbiAgICB9XG4gIH0sXG5cbiAgX3NlYXJjaFN0cmluZzogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHdpbmRvdy5sb2NhdGlvbi5zZWFyY2guc3Vic3RyaW5nKDEpO1xuICB9LFxuXG4gIGF1dG9maWxsOiBmdW5jdGlvbigpIHtcbiAgICBDRC5wYXJhbShcImluaXRcIik7IC8vIGluaXRzIENELl91cmxQYXJhbXNcbiAgICBPYmplY3Qua2V5cyhDRC5fdXJsUGFyYW1zKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgIGlmIChDRC5fdXJsUGFyYW1zW2tleV0gIT09IFwidW5kZWZpbmVkXCIgJiYgQ0QuX3VybFBhcmFtc1trZXldLmxlbmd0aCA+IDApIHtcbiAgICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYXV0b2ZpbGxfXCIgKyBrZXkpKSB7XG4gICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhdXRvZmlsbF9cIiArIGtleSkuaW5uZXJIVE1MID0gQ0QuX3VybFBhcmFtc1trZXldO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG5cbiAgdGhyb3dFcnJvcjogZnVuY3Rpb24obXNnKSB7XG4gICAgaWYodHlwZW9mKE1JQ2FwdHVyZSkgPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgQ0QubG9nKFwiQ2FwdHVyYW1hIGVycm9yOiBcIiArIG1zZyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIE1JQ2FwdHVyZS5lcnJvcihtc2cpO1xuICAgIH1cbiAgfSxcblxuICBjYW5jZWxSZXF1ZXN0OiBmdW5jdGlvbihtc2cpIHtcbiAgICBpZih0eXBlb2YoTUlDYXB0dXJlKSA9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICBDRC5sb2coXCJSZXF1ZXN0IGNhbmNlbGVkOiBcIiArIG1zZyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIE1JQ2FwdHVyZS5jYW5jZWwobXNnKTtcbiAgICB9XG4gIH0sXG5cbiAgc2V0SW1hZ2VSZWRpcmVjdDogZnVuY3Rpb24oaW1hZ2VVcmwpIHtcbiAgICB2YXIgYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbWktcmVkaXJlY3QtaW1hZ2VcIik7XG4gICAgYSA9IGEgfHwgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuXG4gICAgYS5ocmVmID0gaW1hZ2VVcmw7XG4gICAgYS5pZCA9IFwibWktcmVkaXJlY3QtaW1hZ2VcIjtcbiAgICBhLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcblxuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYSk7XG5cbiAgICByZXR1cm4gYTtcbiAgfSxcblxuICBzZXRDbGlja3Rocm91Z2g6IGZ1bmN0aW9uKHVybCkge1xuICAgIHZhciBhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtaV9keW5hbWljX2xpbmtcIik7XG4gICAgYSA9IGEgfHwgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuICAgIGEuaHJlZiA9IHVybDtcbiAgICBhLmlkID0gXCJtaV9keW5hbWljX2xpbmtcIjtcbiAgICBhLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGEpO1xuXG4gICAgcmV0dXJuIGE7XG4gIH0sXG5cbiAgc2V0RXh0cmFEYXRhOiBmdW5jdGlvbihkYXRhT2JqZWN0KSB7XG4gICAgdmFyIGVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtaS1kYXRhXCIpO1xuICAgIGVsID0gZWwgfHwgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgZWwuaWQgPSBcIm1pLWRhdGFcIjtcbiAgICBlbC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cbiAgICB2YXIgZXhpc3RpbmdEYXRhO1xuICAgIHRyeSB7XG4gICAgICBleGlzdGluZ0RhdGEgPSBKU09OLnBhcnNlKGVsLmdldEF0dHJpYnV0ZSgnZGF0YS1taS1kYXRhJykpIHx8IHt9O1xuICAgIH0gY2F0Y2goZSkge1xuICAgICAgLy8gT3ZlcndyaXRlIGlmIHRoZXJlIHdhcyBzb21ldGhpbmcgaW4gbWktZGF0YSB0aGF0IHdhc24ndCBKU09OXG4gICAgICBleGlzdGluZ0RhdGEgPSB7fTtcbiAgICB9XG5cbiAgICBmb3IodmFyIGkgaW4gZGF0YU9iamVjdCkge1xuICAgICAgaWYoZGF0YU9iamVjdC5oYXNPd25Qcm9wZXJ0eShpKSkge1xuICAgICAgICBleGlzdGluZ0RhdGFbaV0gPSBkYXRhT2JqZWN0W2ldO1xuICAgICAgfVxuICAgIH1cbiAgICBlbC5zZXRBdHRyaWJ1dGUoJ2RhdGEtbWktZGF0YScsIEpTT04uc3RyaW5naWZ5KGV4aXN0aW5nRGF0YSkpO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZWwpO1xuXG4gICAgcmV0dXJuIGVsO1xuICB9LFxuXG4gIHByb3h5VXJsOiBmdW5jdGlvbih1cmwpIHtcbiAgICB2YXIgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgICB2YXIgcG9ydCA9IFwiXCI7XG4gICAgYS5ocmVmID0gdXJsO1xuXG4gICAgaWYgKGEucG9ydCA9PT0gJzAnIHx8IGEucG9ydCA9PT0gXCJcIikge1xuICAgICAgcG9ydCA9IGEucHJvdG9jb2wgPT0gXCJodHRwczpcIiA/IFwiOjQ0M1wiIDogXCJcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgcG9ydCA9IFwiOlwiICsgYS5wb3J0O1xuICAgIH1cblxuICAgIHJldHVybiBbXG4gICAgICBDRC5DT1JTX1BST1hZX1NFUlZFUixcbiAgICAgIFwiL1wiLFxuICAgICAgYS5ob3N0bmFtZSxcbiAgICAgIHBvcnQsXG4gICAgICBhLnBhdGhuYW1lLFxuICAgICAgYS5zZWFyY2gsXG4gICAgICBhLmhhc2hcbiAgICBdLmpvaW4oXCJcIik7XG4gIH0sXG5cbiAgLy8gaW50ZXJuYWwsIGRvIG5vdCBtb2RpZnlcbiAgX3JlYWR5VG9DYXB0dXJlOiB0cnVlLFxuXG4gIF9vcGVuQ2FsbHM6IDAsXG5cbiAgX3Jlc2V0OiBmdW5jdGlvbigpIHtcbiAgICBDRC5fb3BlbkNhbGxzID0gMDtcbiAgICBDRC5fcmVhZHlUb0NhcHR1cmUgPSB0cnVlO1xuICB9LFxuXG4gIHN1c3BlbmQ6IGZ1bmN0aW9uKG1heFN1c3BlbnNpb24sIG1zZykge1xuICAgIG1zZyA9IG1zZyB8fCBcIm1hbnVhbCBzdXNwZW5zaW9uXCI7XG5cbiAgICBpZihtYXhTdXNwZW5zaW9uKSB7XG4gICAgICBtc2cgKz0gXCIsIHdpbGwgZW5kIGluIFwiICsgbWF4U3VzcGVuc2lvbiArIFwibXNcIjtcblxuICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgQ0QuY2FwdHVyZShtc2cpO1xuICAgICAgfSwgbWF4U3VzcGVuc2lvbik7XG4gICAgfVxuXG4gICAgQ0QuX29wZW5DYWxscysrO1xuICAgIENELl9yZWFkeVRvQ2FwdHVyZSA9IGZhbHNlO1xuICAgIGlmICh0eXBlb2YoTUlDYXB0dXJlKSA9PSAndW5kZWZpbmVkJykge1xuICAgICAgQ0QubG9nKFwic3VzcGVuZGVkOiBcIiArIG1zZyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIE1JQ2FwdHVyZS5iZWdpbihtc2cpO1xuICAgIH1cbiAgfSxcblxuICBjYXB0dXJlOiBmdW5jdGlvbihtc2cpIHtcbiAgICBDRC5fb3BlbkNhbGxzLS07XG5cbiAgICBpZihDRC5fb3BlbkNhbGxzID4gMCkge1xuICAgICAgQ0QubG9nKFwib3V0c3RhbmRpbmcgY2FsbHMsIG5vdCBjYXB0dXJpbmc6IFwiICsgbXNnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBDRC5fcmVhZHlUb0NhcHR1cmUgPSB0cnVlO1xuICAgIGlmKHR5cGVvZihNSUNhcHR1cmUpID09ICd1bmRlZmluZWQnKSB7XG4gICAgICBDRC5sb2coXCJub3cgcmVhZHkgdG8gY2FwdHVyZTogXCIgKyBtc2cpO1xuICAgIH0gZWxzZSB7XG4gICAgICBDRC4kKCdib2R5JylbMF0uc3R5bGUud2lkdGggPSBDRC4kKCdib2R5JylbMF0ub2Zmc2V0V2lkdGggKyAncHgnO1xuICAgICAgTUlDYXB0dXJlLmVuZChtc2cpO1xuICAgIH1cbiAgfSxcblxuICBnZXRDT1JTOiBmdW5jdGlvbih1cmwsIG9wdGlvbnMsIGNhbGxiYWNrKSB7XG4gICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO1xuXG4gICAgdXJsID0gYXJnc1swXTtcbiAgICBjYWxsYmFjayA9IGFyZ3MucG9wKCk7XG4gICAgb3B0aW9ucyA9IGFyZ3NbMV0gfHwge307XG5cbiAgICBvcHRpb25zLmNvcnNDYWNoZVRpbWUgPSBvcHRpb25zLmNvcnNDYWNoZVRpbWUgfHwgMTAgKiAxMDAwO1xuICAgIGlmKCF1cmwubWF0Y2goL2NvcnMubW92YWJsZWluay5jb20vKSkge1xuICAgICAgdXJsID0gQ0QucHJveHlVcmwodXJsKTtcbiAgICB9XG5cbiAgICBvcHRpb25zLmhlYWRlcnMgPSBvcHRpb25zLmhlYWRlcnMgfHwge307XG4gICAgb3B0aW9ucy5oZWFkZXJzWyd4LXJldmVyc2UtcHJveHktdHRsJ10gPSBvcHRpb25zLmNvcnNDYWNoZVRpbWUgLyAxMDAwO1xuICAgIG9wdGlvbnMuaGVhZGVyc1sneC1taS1jYmUnXSA9IHRoaXMuX2hhc2hGb3JSZXF1ZXN0KHVybCwgb3B0aW9ucyk7XG5cbiAgICByZXR1cm4gQ0QuZ2V0KHVybCwgb3B0aW9ucywgY2FsbGJhY2spO1xuICB9LFxuXG4gIGdldDogZnVuY3Rpb24odXJsLCBvcHRpb25zLCBjYWxsYmFjaykge1xuICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtcblxuICAgIHVybCA9IGFyZ3NbMF07XG4gICAgY2FsbGJhY2sgPSBhcmdzLnBvcCgpO1xuICAgIG9wdGlvbnMgPSBhcmdzWzFdIHx8IHt9O1xuXG4gICAgdmFyIG1zZyA9IFwieGhyOiBcIiArIHVybDtcblxuICAgIHZhciByZXEgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblxuICAgIHJlcS5vbmVycm9yID0gZnVuY3Rpb24gKCkge1xuICAgICAgQ0QuY2FwdHVyZShtc2cpO1xuICAgICAgQ0QubG9nKFwiWEhSIGVycm9yIGZvciBcIiArIHVybCk7XG4gICAgICBjYWxsYmFjayhudWxsLCB0aGlzLnN0YXR1cyk7XG4gICAgfTtcbiAgICByZXEub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICBDRC5jYXB0dXJlKG1zZyk7XG4gICAgICB2YXIgY29udGVudFR5cGUgPSB0aGlzLmdldFJlc3BvbnNlSGVhZGVyKCdjb250ZW50LXR5cGUnKTtcbiAgICAgIGNhbGxiYWNrKHRoaXMucmVzcG9uc2VUZXh0LCB0aGlzLnN0YXR1cywgY29udGVudFR5cGUpO1xuICAgIH07XG5cbiAgICByZXEub3BlbihvcHRpb25zLm1ldGhvZCB8fCAnR0VUJywgdXJsLCB0cnVlKTtcblxuICAgIHJlcS53aXRoQ3JlZGVudGlhbHMgPSB0cnVlO1xuXG4gICAgaWYob3B0aW9ucy5oZWFkZXJzKSB7XG4gICAgICBmb3IodmFyIGhlYWRlciBpbiBvcHRpb25zLmhlYWRlcnMpIHtcbiAgICAgICAgcmVxLnNldFJlcXVlc3RIZWFkZXIoaGVhZGVyLCBvcHRpb25zLmhlYWRlcnNbaGVhZGVyXSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmVxLnNlbmQob3B0aW9ucy5ib2R5KTtcbiAgICBDRC5zdXNwZW5kKG9wdGlvbnMubWF4U3VzcGVuc2lvbiwgbXNnKTtcbiAgfSxcblxuICBnZXRJbWFnZTogZnVuY3Rpb24odXJsLCBvcHRpb25zLCBjYWxsYmFjaykge1xuICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtcblxuICAgIGNhbGxiYWNrID0gYXJncy5wb3AoKTtcbiAgICB1cmwgPSBhcmdzWzBdO1xuICAgIG9wdGlvbnMgPSBhcmdzWzFdIHx8IHt9O1xuICAgIHZhciBtc2cgPSBcImdldEltYWdlOiBcIiArIHVybDtcblxuICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTtcbiAgICBpbWcub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICBDRC5jYXB0dXJlKG1zZyk7XG4gICAgICBpZihjYWxsYmFjaykgeyBjYWxsYmFjayhpbWcpOyB9XG4gICAgfTtcbiAgICBpbWcub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgQ0QuY2FwdHVyZShtc2cpO1xuICAgICAgY2FsbGJhY2sobnVsbCk7XG4gICAgfTtcbiAgICBpbWcuc3JjID0gdXJsO1xuICAgIENELnN1c3BlbmQob3B0aW9ucy5tYXhTdXNwZW5zaW9uLCBtc2cpO1xuICB9LFxuXG4gIGdldEltYWdlczogZnVuY3Rpb24odXJscywgb3B0aW9ucywgY2FsbGJhY2ssIHNpbmdsZUNhbGxiYWNrKSB7XG4gICAgaWYodHlwZW9mKG9wdGlvbnMpID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgIHNpbmdsZUNhbGxiYWNrID0gY2FsbGJhY2s7XG4gICAgICBjYWxsYmFjayA9IG9wdGlvbnM7XG4gICAgICBvcHRpb25zID0ge307XG4gICAgfVxuXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG5cbiAgICB2YXIgaW1hZ2VzTGVmdCA9IHVybHMubGVuZ3RoO1xuICAgIHZhciBpbWdzID0gW107XG4gICAgdmFyIGNhbGxlZEluZGV4ID0gLTE7XG4gICAgdmFyIG1zZyA9IFwiZ2V0SW1hZ2VzXCI7XG5cbiAgICBmb3IodmFyIGkgPSAwOyBpIDwgdXJscy5sZW5ndGg7IGkrKykge1xuICAgICAgKGZ1bmN0aW9uKHVybCwgaSl7XG5cbiAgICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpO1xuXG4gICAgICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpbWFnZXNMZWZ0IC09IDE7XG4gICAgICAgICAgaW1nc1tpXSA9IGltZztcbiAgICAgICAgICBjYWxsYmFja05leHQoKTtcbiAgICAgICAgICBmaW5pc2goKTtcbiAgICAgICAgfTtcbiAgICAgICAgaW1nLm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpbWFnZXNMZWZ0IC09IDE7XG4gICAgICAgICAgQ0QubG9nKFwiSW1hZ2UgbG9hZCBlcnJvciBmb3IgXCIgKyB1cmwpO1xuICAgICAgICAgIGZpbmlzaCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGltZy5zcmMgPSB1cmw7XG4gICAgICB9KSh1cmxzW2ldLCBpKTtcbiAgICB9XG5cbiAgICBDRC5zdXNwZW5kKG9wdGlvbnMubWF4U3VzcGVuc2lvbiwgbXNnKTtcblxuICAgIGZ1bmN0aW9uIGNhbGxiYWNrTmV4dCgpIHtcbiAgICAgIHZhciBuZXh0ID0gY2FsbGVkSW5kZXggKyAxO1xuICAgICAgaWYoaW1nc1tuZXh0XSkge1xuICAgICAgICBpZihzaW5nbGVDYWxsYmFjaykge1xuICAgICAgICAgIHNpbmdsZUNhbGxiYWNrKGltZ3NbbmV4dF0pO1xuICAgICAgICB9XG4gICAgICAgIGNhbGxlZEluZGV4ID0gbmV4dDtcbiAgICAgICAgY2FsbGJhY2tOZXh0KCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZmluaXNoKCkge1xuICAgICAgaWYoaW1hZ2VzTGVmdCA9PSAwKSB7XG4gICAgICAgIENELmNhcHR1cmUobXNnKTtcbiAgICAgICAgaWYoY2FsbGJhY2spIHtcbiAgICAgICAgICBjYWxsYmFjayhpbWdzKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcblxuICB3YWl0Rm9yQXNzZXQ6IGZ1bmN0aW9uKGFzc2V0VXJsKSB7XG4gICAgaWYodHlwZW9mKE1JQ2FwdHVyZSkgPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgQ0QubG9nKFwiV2FpdCBmb3IgYXNzZXQ6IFwiICsgYXNzZXRVcmwpO1xuICAgIH0gZWxzZSB7XG4gICAgICBNSUNhcHR1cmUud2FpdEZvckFzc2V0KGFzc2V0VXJsKTtcbiAgICB9XG4gIH0sXG5cbiAgbG9nOiBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAgY29uc29sZS5sb2cobWVzc2FnZSk7XG4gIH0sXG5cbiAgX2hhc2hGb3JSZXF1ZXN0OiBmdW5jdGlvbih1cmwsIG9wdGlvbnMpIHtcbiAgICB2YXIgc3RyID0gdXJsICsgSlNPTi5zdHJpbmdpZnkob3B0aW9ucyk7XG4gICAgdmFyIGhhc2ggPSAwO1xuICAgIGlmIChzdHIubGVuZ3RoID09PSAwKSByZXR1cm4gaGFzaDtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykge1xuICAgICAgaGFzaCA9ICgoaGFzaCA8PCA1KSAtIGhhc2gpICsgc3RyLmNoYXJDb2RlQXQoaSkgJiAweEZGRkZGRkZGO1xuICAgIH1cbiAgICByZXR1cm4gaGFzaC50b1N0cmluZygpO1xuICB9XG59O1xuXG5leHBvcnQgZGVmYXVsdCBDRDtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4uL34vY3JvcGR1c3Rlci9zcmMvY3JvcGR1c3Rlci5qc1xuLy8gbW9kdWxlIGlkID0gMlxuLy8gbW9kdWxlIGNodW5rcyA9IDAiXSwic291cmNlUm9vdCI6IiJ9